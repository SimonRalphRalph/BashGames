<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>playform — Play With Your Imagination</title>

  <style>
    /* =========================================================
       Playform — OpenAI‑inspired theme (refactored)
       Users can generate games WITHOUT logging in.
       ========================================================= */

    /* -------------------- */
    /* TOKENS (dark)        */
    /* -------------------- */
    :root{
      --bg: #0B0C0E;
      --surface: #0E0F12;
      --panel: #111216;
      --panel-2: #0B0C0D;
      --card: #0F1114;

      --text: #ECEDEE;
      --muted: #9AA0A6;
      --stroke: rgba(255,255,255,0.09);

      --brand: #14A37F;
      --brand-2: #2BB891;

      --canvas-bg: #0A0B0D;

      --radius: 12px;
      --shadow: 0 8px 24px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,0.02) inset;

      --fs-1: clamp(14px, 1.4vw, 15px);
      --fs-2: clamp(16px, 1.6vw, 17px);
      --fs-3: clamp(18px, 1.8vw, 19px);
      --fs-4: clamp(20px, 2vw, 22px);
    }

    /* -------------------- */
    /* TOKENS (light)       */
    /* -------------------- */
    html[data-theme="light"]{
      --bg: #FFFFFF;
      --surface: #FFFFFF;
      --panel: #FFFFFF;
      --panel-2: #F7F8F8;
      --card: #FFFFFF;

      --text: #0C0D0E;
      --muted: #5C6269;
      --stroke: rgba(0,0,0,0.08);

      --canvas-bg: #F7F8F8;
    }

    /* -------------------- */
    /* THEME OVERRIDES      */
    /* -------------------- */
    html[data-theme="light"] :is(.btn.brand, .pill-btn.brand){
      background: color-mix(in oklab, var(--brand) 92%, white 8%);
      border-color: color-mix(in oklab, var(--brand) 50%, var(--stroke) 50%);
      color: white;
    }
    html[data-theme="light"] :is(.btn.brand:hover, .pill-btn.brand:hover){
      background: color-mix(in oklab, var(--brand) 100%, white 0%);
    }

    /* -------------------- */
    /* RESET + BASE         */
    /* -------------------- */
    *{ box-sizing: border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.45;
      color: var(--text);
      background:
        radial-gradient(800px 400px at 70% -10%, rgba(32,40,48,.26) 0%, rgba(32,40,48,0) 55%),
        conic-gradient(from 180deg at 50% -20%, rgba(255,255,255,.06), rgba(255,255,255,0)),
        var(--bg);
    }
    a{ color:inherit; text-decoration:none; }
    button{ cursor:pointer; font:inherit; }
    :where(a,button,input,textarea,select):focus-visible{
      outline:2px solid var(--brand); outline-offset:2px; border-radius:8px;
    }
    @media (prefers-reduced-motion: reduce){
      *{ animation-duration: .001ms!important; animation-iteration-count:1!important; transition-duration:.001ms!important; scroll-behavior:auto!important; }
    }

    /* -------------------- */
    /* LAYOUT               */
    /* -------------------- */
    header.nav{
      position:sticky; top:0; z-index:30;
      background: color-mix(in oklab, var(--surface) 94%, transparent);
      backdrop-filter: saturate(130%) blur(8px);
      border-bottom:1px solid var(--stroke);
    }
    .nav-inner{ display:flex; align-items:center; gap:12px; padding:10px clamp(12px,3vw,20px); }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:750; letter-spacing:.2px; }
    .brand .logo{
      width:30px; height:30px; border-radius:8px; display:grid; place-items:center;
      background: var(--panel-2);
      border:1px solid var(--stroke);
      box-shadow: 0 0 0 2px rgba(20,163,127,.12);
    }
    .brand .logo svg{ opacity:.92 }

    .search-wrap{ flex:1; display:flex; justify-content:center; }
    .search{
      width:min(720px,95%); display:flex; align-items:center; gap:10px;
      background:var(--panel); border:1px solid var(--stroke); border-radius:999px; padding:10px 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.02);
    }
    .search input{ flex:1; background:transparent; border:0; color:var(--text); outline:none; font-size:var(--fs-2); }
    .nav-cta{ margin-left:auto; display:flex; gap:8px; }

    .layout{
      display:grid; grid-template-columns: 260px 1fr; gap:18px;
      padding:18px; max-width:1360px; margin-inline:auto;
    }
    .content{ min-height:60vh; grid-column:1 / -1; } /* center the studio block row */

    /* -------------------- */
    /* UTIL SURFACES        */
    /* -------------------- */
    .u-surface{ background:var(--panel); border:1px solid var(--stroke); border-radius:var(--radius); }

    /* -------------------- */
    /* COMPONENTS           */
    /* -------------------- */

    /* Sidebar */
    .sidebar{
      background:var(--panel); border:1px solid var(--stroke); border-radius:var(--radius);
      padding:12px; position:sticky; top:72px; height:calc(100vh - 90px); overflow:auto;
    }
    .sidebar h3{ margin:10px 10px 4px; font-size:12px; text-transform:uppercase; letter-spacing:1px; color:var(--muted); }
    .subs-list{ display:flex; flex-direction:column; gap:6px; padding:6px; }
    .sub-item{ display:flex; align-items:center; gap:10px; padding:8px; border-radius:10px; transition:background .15s ease; }
    .sub-item:hover{ background:var(--panel-2); }
    .avatar{ width:28px; height:28px; border-radius:999px; background: radial-gradient(35% 35% at 30% 30%, #2BB891 0%, #14A37F 45%, var(--panel-2) 100%); border:1px solid var(--stroke); }

    /* Studio / Prompt */
    #view{ display:grid; gap:16px; }
    .studio{
      background:var(--panel); border:1px solid var(--stroke); border-radius:var(--radius);
      padding:16px; display:grid; gap:14px; box-shadow:var(--shadow);
      width:min(980px,100%); justify-self:center;
    }
    .prompt-wrap{ display:flex; align-items:flex-start; gap:10px; background:var(--card); border:1px solid var(--stroke); padding:12px; border-radius:14px; }
    .prompt-wrap textarea{ flex:1; min-height:68px; max-height:220px; width:100%; resize:vertical; background:transparent; border:0; color:var(--text); outline:none; font-size:var(--fs-2); }
    .prompt-actions{ display:flex; flex-wrap:wrap; gap:8px; }
    .canvas-wrap{ display:grid; grid-template-columns: 1fr 380px; gap:14px; }
    .play-area{ background:var(--panel-2); border:1px solid var(--stroke); border-radius:14px; padding:14px; display:grid; place-items:center; }
    .play-area canvas{ background:var(--canvas-bg); border-radius:10px; width:100%; height:auto; aspect-ratio:16/10; border:1px solid rgba(0,0,0,.03); }
    .game-meta{ background:var(--panel-2); border:1px solid var(--stroke); border-radius:14px; padding:14px; display:flex; flex-direction:column; gap:10px; }
    .field{ display:flex; flex-direction:column; gap:6px; }
    .field :is(input, textarea, select){ background:var(--panel); border:1px solid var(--stroke); color:var(--text); padding:10px 12px; border-radius:10px; outline:none; }
    .field :is(input, textarea)::placeholder{ color: color-mix(in oklab, var(--muted) 80%, transparent); }

    /* Cards / grids */
    .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:14px; }
    .card{ background:var(--panel); border:1px solid var(--stroke); border-radius:14px; overflow:hidden; display:flex; flex-direction:column; transition: transform .08s ease, border-color .15s ease; }
    .card:hover{ transform: translateY(-1px); border-color: color-mix(in oklab, var(--stroke) 70%, var(--brand) 30%); }
    .thumb{ position:relative; background:var(--panel-2); height:130px; display:grid; place-items:center; }
    .thumb .pill{ position:absolute; top:8px; left:8px; background: rgba(20,163,127,.14); border:1px solid rgba(20,163,127,.28); color:#0c3; font-size:12px; padding:4px 8px; border-radius:999px; }
    .thumb img{ width:100%; height:100%; object-fit:cover; }
    .card .info{ padding:10px; display:grid; gap:8px; }
    .mini{ display:flex; align-items:center; gap:8px; color:var(--muted); font-size:13px; }

    .section-title{ display:flex; align-items:center; justify-content:space-between; margin:16px 0 10px; }
    .section-title h2{ font-size:var(--fs-3); margin:0; }

    /* Game page */
    .game-page{ display:grid; grid-template-columns: 1fr 360px; gap:16px; }
    .game-hero{ background:var(--panel); border:1px solid var(--stroke); border-radius:14px; padding:12px; box-shadow:var(--shadow); }
    .game-hero canvas{ width:100%; height:auto; aspect-ratio:16/10; background:var(--canvas-bg); border-radius:10px; border:1px solid rgba(0,0,0,.03); }
    .game-side{ display:flex; flex-direction:column; gap:12px; }
    .game-box{ background:var(--panel); border:1px solid var(--stroke); border-radius:14px; padding:12px; }
    .row{ display:flex; align-items:center; gap:8px; }
    .row.spread{ justify-content:space-between; }
    .comment{ border-top:1px dashed var(--stroke); padding:8px 0; }
    .comment small{ color:var(--muted); }

    /* Buttons / Pills */
    .btn{ background:var(--panel); border:1px solid var(--stroke); color:var(--text); padding:9px 13px; border-radius:10px; font-weight:600; transition: transform .06s ease, background .2s ease, border-color .2s ease; }
    .btn:hover{ background: color-mix(in oklab, var(--panel) 85%, white 0%); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); }
    .btn.brand{ background: color-mix(in oklab, var(--brand) 18%, black 82%); border-color: color-mix(in oklab, var(--brand) 35%, black 65%); color:white; }
    .btn.ghost{ background:transparent; border:1px solid var(--stroke); }

    .pill-btn{ background:var(--panel); border:1px solid var(--stroke); padding:8px 12px; border-radius:999px; font-weight:600; transition: background .15s, border-color .15s, transform .06s; }
    .pill-btn:hover{ background: color-mix(in oklab, var(--panel) 85%, white 0%); transform: translateY(-1px); }
    .pill-btn.brand{ background: color-mix(in oklab, var(--brand) 18%, black 82%); border-color: color-mix(in oklab, var(--brand) 35%, black 65%); color:white; }

    /* Modals */
    .modal{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.55); z-index:50; }
    .modal.active{ display:grid; }
    html[data-theme="light"] .modal{ background: rgba(0,0,0,.35); }
    .dialog{ width:min(520px,92%); background:var(--panel); border:1px solid var(--stroke); border-radius:16px; padding:16px; box-shadow:var(--shadow); }
    .dialog h3{ margin-top:0; }

    .link{ color:var(--brand-2); font-weight:600; }
    .link:hover{ text-decoration:underline; text-underline-offset:2px; }
    .empty{ border:1px dashed var(--stroke); background: color-mix(in oklab, var(--panel) 88%, white 0%); padding:18px; border-radius:14px; text-align:center; color:var(--muted); }

    /* -------------------- */
    /* UTILITIES            */
    /* -------------------- */
    .centered{ margin-inline:auto; }
    .hidden{ display:none !important; }

    /* -------------------- */
    /* MEDIA QUERIES        */
    /* -------------------- */
    @media (max-width:1024px){
      .canvas-wrap{ grid-template-columns:1fr; }
      .game-page{ grid-template-columns:1fr; }
      .layout{ grid-template-columns:1fr; }
      .sidebar{ display:none; }
      .search{ width:100%; }
    }
  </style>
</head>
<body>
  <!-- =============================================
       Header / Navigation
       ============================================= -->
  <header class="nav">
    <div class="nav-inner">
      <a href="#home" class="brand" aria-label="GameStudio Home">
        <span class="logo" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 12C3 7.582 6.582 4 11 4h2a8 8 0 1 1-8 8v0Z" fill="currentColor" opacity=".16"/>
            <path d="M7 12a5 5 0 0 1 5-5h2v10h-2a5 5 0 0 1-5-5Z" fill="currentColor"/>
          </svg>
        </span>
        <span>playform</span>
      </a>

      <div class="search-wrap">
        <div class="search" role="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 21l-4.2-4.2M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="#95a0ae" stroke-width="2" stroke-linecap="round"/></svg>
          <input id="searchInput" placeholder="Search games, creators... (Press Enter)" />
        </div>
      </div>

      <div class="nav-cta" id="authButtons">
        <button class="btn ghost" id="btnSignIn">Log in</button>
        <button class="btn brand" id="btnSignUp">Sign up</button>
      </div>

      <div class="nav-cta" id="userMenu" style="display:none">
        <button class="btn" id="btnLiked">Liked</button>
        <button class="btn" id="btnSubscriptions">Subscriptions</button>
        <button class="btn ghost" id="btnSignOut">Sign out</button>
      </div>
    </div>
  </header>

  <!-- =============================================
       Main App Layout
       ============================================= -->
  <main class="layout">
    <!-- Sidebar for logged-in users -->
    <aside class="sidebar u-surface" id="sidebar">
      <h3>Your Subscriptions</h3>
      <div id="subsList" class="subs-list"></div>
      <hr style="border-color:var(--stroke); opacity:.35; margin:10px 0">
      <button class="pill-btn brand" id="sidebarLikedBtn">Liked Games</button>
    </aside>

    <!-- Content area populated by router -->
    <section class="content" id="view"></section>
  </main>

  <!-- =============================================
       Modals: Sign In / Sign Up & Require Account
       ============================================= -->
  <div class="modal" id="authModal" aria-hidden="true" role="dialog">
    <div class="dialog">
      <h3 id="authTitle">Create your free account</h3>
      <p style="margin-top:-6px; color:var(--muted)">Sign up or log in to create, play, and connect.</p>
      <div class="field"><label>Username</label><input id="authUsername" placeholder="e.g. pixel_wizard"/></div>
      <div class="field"><label>Password</label><input id="authPassword" type="password" placeholder="••••••••"/></div>
      <div class="row" style="justify-content:flex-end; gap:8px; margin-top:10px">
        <button class="btn ghost" id="authCancel">Cancel</button>
        <button class="btn brand" id="authConfirm">Continue</button>
      </div>
    </div>
  </div>

  <div class="modal" id="requireModal" aria-hidden="true" role="dialog">
    <div class="dialog">
      <h3>Sign in to save & publish</h3>
      <p style="color:var(--muted)">You can generate and play games without an account. Sign in if you want to save drafts, publish, like, or comment.</p>
      <div class="row" style="justify-content:flex-end; gap:8px">
        <button class="btn ghost" onclick="toggleModal('requireModal', false)">Close</button>
        <button class="btn brand" onclick="openAuth('signup')">Create Account</button>
      </div>
    </div>
  </div>

  <!-- =============================================
       Templates (cloned in JS)
       ============================================= -->
  <template id="cardTemplate">
    <article class="card">
      <a class="thumb" href="#">
        <div class="pill" data-pill>★ Trending</div>
        <img data-thumb alt="thumbnail"/>
      </a>
      <div class="info">
        <a class="row" data-titleLink href="#" style="gap:8px">
          <div class="avatar" data-avatar aria-hidden="true"></div>
          <div style="display:grid">
            <strong data-title></strong>
            <span class="mini"><span data-creator></span> • <span data-likes></span> likes</span>
          </div>
        </a>
      </div>
    </article>
  </template>

  <!-- =============================================
       App Script
       ============================================= -->
  <script>
    /*
      GameStudio — Single-file SPA with a mock backend using localStorage.
      CHANGES: Non-logged-in users can generate/run games freely in the studio.
               Saving drafts, publishing, liking, commenting still require login.

      Storage keys:
        gba_users, gba_currentUser, gba_games, gba_comments_<id>, gba_initialized
    */

    // ---------- Utilities ----------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const uid = () => Math.random().toString(36).slice(2, 10);
    const nowISO = () => new Date().toISOString();

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.cssText = `position:fixed;left:50%;top:20px;transform:translateX(-50%);background:var(--panel);color:var(--text);border:1px solid var(--stroke);padding:10px 14px;border-radius:999px;z-index:80;box-shadow:var(--shadow)`;
      document.body.appendChild(t); setTimeout(()=>t.remove(), 1800);
    }
    function toggleModal(id, show){ const m = document.getElementById(id); if(!m) return; m.classList.toggle('active', !!show); }

    // Read a CSS custom property with a fallback
    function getCSSVar(name, fallback) {
      const v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
      return v || fallback;
    }

    // ---------- Storage API (mock backend) ----------
    const getUsers = () => JSON.parse(localStorage.getItem('gba_users')||'[]');
    const setUsers = v => localStorage.setItem('gba_users', JSON.stringify(v));
    const getCurrentUser = () => localStorage.getItem('gba_currentUser');
    const setCurrentUser = u => { if(u) localStorage.setItem('gba_currentUser', u); else localStorage.removeItem('gba_currentUser'); updateAuthUI(); };
    const getGames = () => JSON.parse(localStorage.getItem('gba_games')||'[]');
    const setGames = v => localStorage.setItem('gba_games', JSON.stringify(v));
    const getComments = id => JSON.parse(localStorage.getItem('gba_comments_'+id)||'[]');
    const setComments = (id, arr) => localStorage.setItem('gba_comments_'+id, JSON.stringify(arr));

    // Preload sample games only once
    function preloadGames(){
      if(localStorage.getItem('gba_initialized')) return;
      const samples = [
        { key:'snake', title:'Snake', description:'Classic arrow-key snake game. Eat pellets, avoid yourself!', code: GAME_TEMPLATES.snake },
        { key:'pong', title:'Pong', description:'Two paddles and a ball. Up/Down arrows vs. W/S keys.', code: GAME_TEMPLATES.pong },
        { key:'breakout', title:'Breakout', description:'Bounce the ball to clear bricks. Move with left/right arrows.', code: GAME_TEMPLATES.breakout },
      ];
      const creators = ['ArcadeLab', 'RetroCoder', 'BrickSmith'];
      const games = getGames();
      samples.forEach((s, i)=>{
        const id = uid();
        games.push({ id, title:s.title, description:s.description, creator: creators[i]||'Guest', code:s.code, likes: Math.floor(Math.random()*200+50), published:true, createdAt: nowISO(), thumbnail: PLACEHOLDER_THUMB(s.title) });
        setComments(id, [ {user:'DemoFan', text:'Love this!', ts: nowISO()}, {user:'PlayerTwo', text:'So nostalgic 👾', ts: nowISO()} ]);
      });
      setGames(games);
      setUsers([
        {username:'ArcadeLab', password:'demo', likedGames:[], subscriptions:['RetroCoder']},
        {username:'RetroCoder', password:'demo', likedGames:[], subscriptions:[]},
        {username:'BrickSmith', password:'demo', likedGames:[], subscriptions:['ArcadeLab']},
      ]);
      localStorage.setItem('gba_initialized','yes');
    }

    // ---------- Thumbnails ----------
    function PLACEHOLDER_THUMB(title){
      const initials = (title||'G').split(/\s+/).map(w=>w[0]).slice(0,2).join('').toUpperCase();
      const hue = Math.abs(hashCode(title))%360;
      const svg = encodeURIComponent(`<?xml version="1.0"?>
<svg xmlns='http://www.w3.org/2000/svg' width='480' height='280'>
  <defs>
    <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
      <stop offset='0%' stop-color='hsl(${hue},70%,50%)'/>
      <stop offset='100%' stop-color='hsl(${(hue+60)%360},70%,50%)'/>
    </linearGradient>
  </defs>
  <rect width='100%' height='100%' fill='url(#g)'/>
  <text x='50%' y='52%' dominant-baseline='middle' text-anchor='middle' font-family='Inter, Arial, Helvetica, sans-serif' font-size='110' fill='rgba(255,255,255,.9)' font-weight='800'>${initials}</text>
</svg>`);
      return `data:image/svg+xml,${svg}`;
    }
    function hashCode(str=""){let h=0; for(let i=0;i<str.length;i++){h=((h<<5)-h)+str.charCodeAt(i)|0;} return h;}

    // ---------- Auth UI ----------
    function updateAuthUI(){
      const isLogged = !!getCurrentUser();
      document.getElementById('sidebar').style.display = isLogged? 'block':'none';
      document.getElementById('authButtons').style.display = isLogged? 'none':'flex';
      document.getElementById('userMenu').style.display = isLogged? 'flex':'none';
      if(isLogged) buildSubsList();
    }
    function openAuth(mode){ toggleModal('authModal', true); $('#authTitle').textContent = mode==='signin'? 'Welcome back' : 'Create your free account'; $('#authConfirm').dataset.mode = mode; $('#authPassword').value=''; $('#authUsername').value=''; }
    function handleAuth(){
      const mode = $('#authConfirm').dataset.mode||'signup';
      const u = $('#authUsername').value.trim();
      const p = $('#authPassword').value.trim();
      if(!u || !p) return toast('Please enter a username & password.');
      const users = getUsers();
      if(mode==='signup'){
        if(users.some(x=>x.username.toLowerCase()===u.toLowerCase())) return toast('Username already exists.');
        users.push({username:u, password:p, likedGames:[], subscriptions:[]}); setUsers(users); setCurrentUser(u); toggleModal('authModal', false); toast('Account created!');
      } else {
        const acc = users.find(x=>x.username.toLowerCase()===u.toLowerCase() && x.password===p);
        if(!acc) return toast('Invalid credentials.'); setCurrentUser(acc.username); toggleModal('authModal', false); toast('Signed in.');
      }
      router();
    }

    // ---------- Router ----------
    function parseHash(){ const h = location.hash.replace('#',''); const [path, query] = h.split('?'); const q = Object.fromEntries(new URLSearchParams(query||'').entries()); return { path: path||'home', query:q }; }
    function router(){
      const {path, query} = parseHash();
      if(path==='home') renderHome();
      else if(path==='game') renderGamePage(query.id);
      else if(path==='profile') renderProfile(query.user);
      else if(path==='liked') renderLiked();
      else if(path==='subs') renderSubscriptions();
      else if(path==='search') renderSearch(query.q||'');
      else renderHome();
      updateAuthUI();
    }
    
<main>
  
  <!-- load JavaScript -->
<script src="js/app.js?v=1" defer></script>
</body>
</html>